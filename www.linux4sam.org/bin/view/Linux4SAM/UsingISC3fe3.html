<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from www.linux4sam.org/bin/view/Linux4SAM/UsingISC?skin=print.myskin by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Jul 2021 19:10:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=iso-8859-1" /><!-- /Added by HTTrack -->
<head>
<link rel="stylesheet" href="https://www.linux4sam.org/pub/TWiki/RedDotPlugin/style.css" type="text/css" media="all" />
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-migrate.js"></script>
<link rel="stylesheet" href="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-all.css" type="text/css" media="all" />
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-all.js"></script>
<title>TWiki &middot; Linux4SAM &middot; UsingISC &middot; (printable)</title>
<base  />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Content-Style-Type" content="text/css" /> 
<meta name="generator" content="TWiki/NatSkin" /> 
<link rel="icon" href="https://www.linux4sam.org/pub/Linux4SAM/WebPreferences/favicon.ico" type="image/x-icon" /> 
<link rel="shortcut icon" href="https://www.linux4sam.org/pub/Linux4SAM/WebPreferences/favicon.ico" type="image/x-icon" />
<!-- 

  Enable the line below when firefox has fixed printing of pages
  that import css. See https://bugzilla.mozilla.org/show_bug.cgi?id=154892 

%GETSKINSTYLE% 

-->
<!-- template javascript -->

<!-- template javascript -->
<style type="text/css">
.natFeedIcon,
.blogEntryFeed,
.blogNavigation,
.blogAddComment {
  display:none;
}
/*
.natExternalLink:after {
  content: " (" attr(href) ") ";
}
*/
%WEBCOMPONENT{"WebCss"}%
</style>
</head>
<body class="natBody natBodyPrint">
<div class="natBodyContents">
  <div class="natMiddle natMain">
	 <div class="natMainContents">
<p /><h1><a name="UsingISC_Image_Sensor_Controller"></a>  <a class="twikiCurrentTopicLink twikiLink" href="UsingISC.html">UsingISC</a> (Image Sensor Controller) </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#Introduction"> Introduction</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#Prerequisites"> Prerequisites</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#Advanced_features"> Advanced features</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#Configuration_in_kernel"> Configuration in kernel</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#Enable_ISC_and_sensor_drivers"> Enable ISC and sensor drivers</a>
</li></ul> 
</li> <li> <a href="index3fe3.html?skin=print.myskin#Configuration_in_U_boot"> Configuration in U-boot</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#SAMA5D2_Xplained_board"> SAMA5D2 Xplained board</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#SAMA5D27_SOM1_EK_board"> SAMA5D27 SOM1 EK  board</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#SAMA5D27_WLSOM1_EK_board"> SAMA5D27 WLSOM1 EK  board</a>
</li></ul> 
</li> <li> <a href="index3fe3.html?skin=print.myskin#Connect_the_sensor_to_ISC"> Connect the sensor to ISC</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#Hardware_connection"> Hardware connection</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#Connection_specification_in_driv"> Connection specification in driver</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#The_boot_message"> The boot message</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#Device_file_and_sysfs"> Device file and sysfs</a>
</li></ul> 
</li> <li> <a href="index3fe3.html?skin=print.myskin#User_space_software"> User space software</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#Use_the_v4l_utils"> Use the v4l-utils</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#v4L2_compliance"> v4L2-compliance </a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#v4l2_ctl"> v4l2-ctl</a>
</li></ul> 
</li> <li> <a href="index3fe3.html?skin=print.myskin#Other_applications"> Other applications</a> <ul>
<li> <a href="index3fe3.html?skin=print.myskin#fswebcam"> fswebcam</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#FFmpeg"> FFmpeg</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#GStreamer"> GStreamer</a>
</li> <li> <a href="index3fe3.html?skin=print.myskin#ZXing_barcode_reader"> ZXing barcode reader</a>
</li></ul> 
</li></ul> 
</li></ul> 
</div>
<p />
<hr />
<p />
<h1><a name="Introduction"></a> Introduction </h1>
This page describes how to configure and use of the ISC in SAMA5D2 SoC with the image sensors.  <ul>
<li> The Image Sensor Controller(ISC) manages incoming data from a sensor up to 12-bit parallel interface. <ul>
<li> The ISC can generate the isc_mck output clock to the image sensor.  <ul>
<li> The isc_mck clock has three selectable clock sources and one programmable clock divider.
</li></ul> 
</li> <li> The ISC can handle pixel clock up to 96MHz, with the maximum resolution of 2592x1944.
</li></ul> 
</li> <li> The ISC includes a video pipeline consist of the following sub-modules: <ul>
<li> PFE: Parallel Front End to sample the camera sensor input stream
</li> <li> WB: Programmable white balance in the Bayer domain
</li> <li> CFA: Color filter array interpolation module
</li> <li> CC: Programmable color correction
</li> <li> GAM: Gamma correction
</li> <li> CSC: Programmable color space conversion
</li> <li> CBC: Contrast and Brightness control
</li> <li> SUB: This module performs YCbCr444 to YCbCr420 chrominance subsampling
</li> <li> RLP: This module performs rounding, range limiting and packing of the incoming data
</li></ul> 
</li> <li> The sub-modules in video pipeline can handle the following input pixel formats: <ul>
<li> Raw Bayer convert to YCbCr
</li> <li> YCbCr (YCbCr 444, YCbCr 422, YCbCr 420), 
</li> <li> Luminance (Black and White) Pixel Format.
</li> <li> 16 bpp RGB, 32 bpp RGB, 16 bpp.
</li></ul> 
</li> <li> For output format,  <ul>
<li> For YCbCr output, the ISC includes a DMA interface which allows YCbCr data organized in packed, semi planar or planar format. 
</li> <li> It can also convert YCbCr to RGB.
</li> <li> It can also be configured as by pass mode, to store original data received from the sensor. 
</li></ul> 
</li></ul> 
<h1><a name="Prerequisites"></a> Prerequisites </h1>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" />  Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.9-at91" target="_blank">Linux Kernel 4.9<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>, we provide and support kernel drivers for ISC.</br></br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" />  Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.14-at91" target="_blank">Linux Kernel 4.14<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.0) , we offer the Device Tree support for the ISC and sensors as an Overlay for the <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> board only. Overlays are required for extension boards, like camera sensors in our case. For more information, visit the <a class="twikiLink" href="DT-Overlay.html">DT-overlays page</a>.</br></br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" />  Starting with Linux4SAM 6.2 , we offer the Device Tree support for the ISC and sensors as an Overlay for the <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>, <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a>  and <a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a> . Overlays are required for extension boards, like camera sensors in our case. For more information, visit the <a class="twikiLink" href="DT-Overlay.html">DT-overlays page</a>. </br></br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" />  Starting with Linux4SAM 2020.04 , we offer additional support for the <span class="twikiNewLink"><a href="https://www.linux4sam.org/bin/edit/Linux4SAM/MT9V022?topicparent=Linux4SAM.UsingISC;nowysiwyg=1" rel="nofollow" title="MT9V022 (this topic does not yet exist; you can create it)">MT9V022</a></span> monochrome Aptina sensor.
<p />
<h1><a name="Advanced_features"></a> Advanced features </h1>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" />  Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.19-at91" target="_blank">Linux Kernel 4.19<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.1) , we offer extended support for the <a class="twikiLink" href="ISCWhiteBalanceFeatures.html">White Balance features</a>.
<p />
<h1><a name="Configuration_in_kernel"></a> Configuration in kernel </h1>
The ISC driver in Linux kernel provides the upper layer interface to the Video4Linux (V4L2) framework. 
To make it work, you should enable the following options in Kernel menuconfig. <ul>
<li> Enable V4L2 framework.  <ul>
<li> Under the menu: "Device Drivers  ---> Multimedia support" <br />      <img src="../../../pub/Linux4SAM/UsingISC/multimedia_support_4.13.0.png" alt="multimedia_support_4.13.0.png" width="794" height="681" /> <ul>
<li> Select the menu "Device Drivers  ---> Multimedia support  ---> Media Controller API"
</li> <li> Select the menu "Device Drivers  ---> Multimedia support  ---> V4L2 sub-device userspace API"
</li> <li> Deselect the menu "Device Drivers  ---> Multimedia support  ---> Autoselect ancillary drivers (tuners, sensors, i2c, spi, frontends)"
</li></ul> 
</li></ul> 
</li></ul> 
<h2><a name="Enable_ISC_and_sensor_drivers"></a> Enable ISC and sensor drivers </h2> <ul>
<li> Select device driver <ul>
<li> V4L platform device can be found in the menu: "Device Drivers  ---> Multimedia support  ---> V4L platform devices" <br />      <img src="../../../pub/Linux4SAM/UsingISC/v4l_platform_devices_4.13.0.png" alt="v4l_platform_devices_4.13.0.png" width="794" height="684" /> <ul>
<li> Deselect the menu "Device Drivers  ---> Multimedia support  ---> V4L platform devices  ---> SoC camera support"
</li> <li> Select the menu "Device Drivers  ---> Multimedia support  ---> V4L platform devices  ---> ATMEL Image Sensor Controller (ISC) support"
</li></ul> 
</li></ul> 
</li> <li> Select sensor driver <ul>
<li> Sensor drivers can be found in the menu "Device Drivers  ---> Multimedia support  ---> I2C Encoders, decoders, sensors and other helper chips " <br />     <img src="../../../pub/Linux4SAM/UsingISC/Screenshot_from_2019-04-23_14-01-23.png" alt="Screenshot_from_2019-04-23_14-01-23.png" width="949" height="600" />
</li> <li> We have tested with <strong>OV7670 , OV7740 and OV5640</strong> image sensors. Starting with Linux4SAM 2020.04 we also tested with <strong>mt9v022</strong>
</li></ul> 
</li></ul> 
<p />
<h1><a name="Configuration_in_U_boot"></a> Configuration in U-boot </h1>
Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.14-at91" target="_blank">Linux Kernel 4.14<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.0) and U-boot 2018.07 , we offer the Device Tree support for the ISC and sensors as an Overlay for <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a>  and <a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a> . Overlays are required for extension boards, like camera sensors in our case. For more information, visit the <a class="twikiLink" href="DT-Overlay.html">DT-overlays page</a>.
<p />
U-boot, if instructed to do so, will load the Device Tree Overlay for the Image sensor controller (ISC) and the Device Tree Overlay for the specific sensor which we support. 
<p />
To instruct U-boot to load the additional required Device Tree Overlays, proceed with the following steps:
<p />
<h2><a name="SAMA5D2_Xplained_board"></a> <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> board </h2>
<p /> <ul>
<li> Step 1: The boot command needs to have an additional overlay for the ISC controller itself. This is an additional FIT image overlay configuration:
</li></ul> 
<pre>
bootm 0x24000000#kernel&#95;dtb#isc
</pre> <ul>
<li> Step 2: The boot command needs to have an additional overlay for the sensor. This is an additional FIT image overlay configuration:
</li></ul> 
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov7670
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov7740
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov5640
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#mt9v022
</pre>
</br>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that both overlay configurations are required, chained as in the command in step 2 above. the 'isc' overlay will add the setup for the ISC, and the ov7670/ov7740/ov5640/mt9v022 will add the setup for the sensor itself.
<p />
The following table summarizes the possible FIT image overlay configurations that are needed:
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table1" rules="all">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top">  </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> Overlay configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Effect </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Requirements </td>
<td bgcolor="#ffffff" class="twikiTableCol4 twikiLastCol" valign="top"> Starting with Linux4SAM version </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Image Sensor Controller </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> isc </td>
<td bgcolor="#edf4f9" class="twikiTableCol2" valign="top"> Adds the Image Sensor Controller setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4 twikiLastCol" valign="top"> Linux4SAM 6.0 </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov7670 </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> ov7670 </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Adds the Omnivision ov7670 setup configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.0 </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov7740 </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> ov7740 </td>
<td bgcolor="#edf4f9" class="twikiTableCol2" valign="top"> Adds the Omnivision ov7740 setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.0 </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov5640 </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> ov5640 </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Adds the Omnivision ov5640 setup configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.1 </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> Aptina MT9V022 </td>
<td bgcolor="#edf4f9" class="twikiTableCol1 twikiLast" valign="top"> mt9v022 </td>
<td bgcolor="#edf4f9" class="twikiTableCol2 twikiLast" valign="top"> Adds the Aptina mt9v022 setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3 twikiLast" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4 twikiLast" colspan="2" valign="top"> Linux4SAM 2020.04 </td>
</tr></table>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that adding just an overlay for the sensor is <strong>not</strong> enough. The 'isc' overlay is a <strong>mandatory prerequisite</strong> .</br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> board is used as a reference, and the software support is created and tested for this board. The SAMA5D2 SoC supports ISC, but to have it up and running, please check your board schematics.
<p />
<h2><a name="SAMA5D27_SOM1_EK_board"></a> <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a>  board </h2>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> This support is only available starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.19-at91" target="_blank">Linux Kernel 4.19<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.1) 
<p /> <ul>
<li> Step 1: The boot command needs to have an additional overlay for the sensor. This is an additional FIT image overlay configuration:
</li></ul> 
<pre>
bootm 0x24000000#kernel&#95;dtb#ov5640
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#mt9v022
</pre>
</br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that only the support for ov5640 and mt9v022 are currently available.
<p />
The following table summarizes the possible FIT image overlay configurations that are needed:
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table2" rules="all">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top">  </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> Overlay configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Effect </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Requirements </td>
<td bgcolor="#ffffff" class="twikiTableCol4 twikiLastCol" valign="top"> Starting with Linux4SAM version </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov5640 </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> ov5640 </td>
<td bgcolor="#edf4f9" class="twikiTableCol2" valign="top"> Adds the Omnivision ov5640 setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.1 </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> Aptina MT9V022 </td>
<td bgcolor="#ffffff" class="twikiTableCol1 twikiLast" valign="top"> mt9v022 </td>
<td bgcolor="#ffffff" class="twikiTableCol2 twikiLast" valign="top"> Adds the Aptina mt9v022 setup configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol3 twikiLast" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol4 twikiLast" colspan="2" valign="top"> Linux4SAM 2020.04 </td>
</tr></table>
<p />
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that the connector on this board <strong>is different</strong> from the one on  <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>. Different wiring/extension board are required .</br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that  <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a> board is used as a reference, and the software support is created and tested for this board. The SAMA5D2 SoC supports ISC, but to have it up and running, please check your board schematics.
<p />
<h2><a name="SAMA5D27_WLSOM1_EK_board"></a> <a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a>  board </h2>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> This support is only available starting with Linux4SAM <strong>6.2</strong>
<p />
    * Step 1: The boot command needs to have an additional overlay for the ISC controller itself. This is an additional FIT image overlay configuration:
<pre>
bootm 0x24000000#kernel&#95;dtb#isc
</pre> <ul>
<li> Step 2: The boot command needs to have an additional overlay for the sensor. This is an additional FIT image overlay configuration:
</li></ul> 
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov7670
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov7740
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#ov5640
</pre>
or</br>
<pre>
bootm 0x24000000#kernel&#95;dtb#isc#mt9v022
</pre>
</br>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that both overlay configurations are required, chained as in the command in step 2 above. the 'isc' overlay will add the setup for the ISC, and the ov7670/ov7740/ov5640/mt9v022 will add the setup for the sensor itself.
<p />
The following table summarizes the possible FIT image overlay configurations that are needed:
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table3" rules="all">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top">  </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> Overlay configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Effect </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Requirements </td>
<td bgcolor="#ffffff" class="twikiTableCol4 twikiLastCol" valign="top"> Starting with Linux4SAM version </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Image Sensor Controller </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> isc </td>
<td bgcolor="#edf4f9" class="twikiTableCol2" valign="top"> Adds the Image Sensor Controller setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4 twikiLastCol" valign="top"> Linux4SAM 6.2 </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov7670 </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> ov7670 </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Adds the Omnivision ov7670 setup configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.2 </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov7740 </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> ov7740 </td>
<td bgcolor="#edf4f9" class="twikiTableCol2" valign="top"> Adds the Omnivision ov7740 setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.2 </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Omnivision ov5640 </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> ov5640 </td>
<td bgcolor="#ffffff" class="twikiTableCol2" valign="top"> Adds the Omnivision ov5640 setup configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol3" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#ffffff" class="twikiTableCol4" colspan="2" valign="top"> Linux4SAM 6.2 </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> Aptina MT9V022 </td>
<td bgcolor="#edf4f9" class="twikiTableCol1 twikiLast" valign="top"> mt9v022 </td>
<td bgcolor="#edf4f9" class="twikiTableCol2 twikiLast" valign="top"> Adds the Aptina mt9v022 setup configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol3 twikiLast" valign="top"> Base Kernel device Tree Blob 'kernel_dtb' configuration and 'isc' configuration </td>
<td bgcolor="#edf4f9" class="twikiTableCol4 twikiLast" colspan="2" valign="top"> Linux4SAM 2020.04 </td>
</tr></table>
<p />
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that the connector on this board <strong>is different</strong> from the one on  <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>. Different wiring/extension board are required .</br>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that  <a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a> board is used as a reference, and the software support is created and tested for this board. The SAMA5D2 SoC supports ISC, but to have it up and running, please check your board schematics.
<p />
<h1><a name="Connect_the_sensor_to_ISC"></a> Connect the sensor to ISC </h1>
<p />
<h2><a name="Hardware_connection"></a> Hardware connection </h2>
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that the connector on <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a>  <strong>is different</strong> from the one on  <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>. Different wiring/extension board are required .</br>
 SAMA5D2 Xplained includes an image sensor connector: <br />
     <img src="../../../pub/Linux4SAM/UsingISC/ISC_connect_schematic.png" alt="ISC_connect_schematic.png" width="1102" height="442" />
<p />
It uses two peripherals from SAMA5D2:  <ul>
<li> ISC: The DVP interface consists of: <ul>
<li> Pixel Clock (VSYNC).
</li> <li> Horizontal Sync (HSYNC).
</li> <li> Vertical Sync (VSYNC).
</li> <li> 8 to 12-bits parallel data interface
</li></ul> 
</li> <li> TWI: an I2C interface to control the sensor's behavior. <ul>
<li> And reset and power down control of the sensor. 
</li></ul> 
</li></ul> 
<h2><a name="Connection_specification_in_driv"></a> Connection specification in driver </h2>
The ISC driver uses the device tree to specify the ISC and sensor device, please refer to the binding document <a href="http://elixir.free-electrons.com/linux/latest/source/Documentation/devicetree/bindings/media/atmel-isc.txt" target="_blank">atmel-isc.txt<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>. 
</br>The binding document explains: <ul>
<li> How the DVP interface of the sensor is connected to SAMA5D2.
</li> <li> How the sensor's I2C control channel is connected to SAMA5D2. <ul>
<li> We should specify the sensor device under the I2C bus as a child node. (for example, the ov7670 must be connected under I2C1 on <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>)
</li> <li> At the same time, we need to specify the pins to control the sensor's reset and power down. (for example, PB11 as reset, PB12 as power down on <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>).
</li> <li> Pay attention to the conflicts with GPIOs. The Device Tree needs to disable the conflicting nodes. <pre>
 reset-gpios &#61; &#60;&#38;pioA 43 GPIO&#95;ACTIVE&#95;LOW&#62;;
 powerdown-gpios &#61; &#60;&#38;pioA 44 GPIO&#95;ACTIVE&#95;HIGH&#62;;
 </pre>
</li></ul> 
</li></ul> 
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that the hardware connections are highly dependent on your board. Check your board schematics to see how the wiring is done.
<p />
Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.14-at91" target="_blank">Linux Kernel 4.14<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.0) and U-boot 2018.07 , we offer the Device Tree support for the ISC and sensors as an Overlay for <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a>. Overlays are required for extension boards, like camera sensors in our case. For more information, visit the <a class="twikiLink" href="DT-Overlay.html">DT-overlays page</a>. </br>
The DT-overlay for the ISC and for the sensors can be consulted in <a href="https://github.com/linux4sam/dt-overlay-at91" target="_blank">our Github repository<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>. </br>
Here are links to the overlays themselves, for the <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> board:   <ul>
<li> <a href="https://github.com/linux4sam/dt-overlay-at91/blob/master/sama5d2_xplained/sama5d2_xplained_isc.dtso" target="_blank">ISC overlay<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li> <li> <a href="https://github.com/linux4sam/dt-overlay-at91/blob/master/sama5d2_xplained/sama5d2_xplained_ov7670.dtso" target="_blank">OV7670 overlay<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li> <li> <a href="https://github.com/linux4sam/dt-overlay-at91/blob/master/sama5d2_xplained/sama5d2_xplained_ov7740.dtso" target="_blank">OV7740 overlay<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li></ul> 
<p />
Starting with <a href="https://github.com/linux4sam/linux-at91/commits/linux-4.19-at91" target="_blank">Linux Kernel 4.19<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (included in Linux4SAM 6.1) we offer additional support for omnivision ov5640 for <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> but also for <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a>.
Here are links to the overlay itself, for the <a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a> board:  <ul>
<li> <a href="https://github.com/linux4sam/dt-overlay-at91/blob/master/sama5d2_xplained/sama5d2_xplained_ov5640.dtso" target="_blank">OV5640 overlay<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li></ul> 
Here are links to the overlay itself, for the <a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a> board:  <ul>
<li> <a href="https://github.com/linux4sam/dt-overlay-at91/blob/master/sama5d27_som1_ek/sama5d27_som1_ek_ov5640.dtso" target="_blank">OV5640 overlay<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li></ul> 
<p />
Starting with Linux4SAM 6.2 we offer support via overlays for all the three sensors (ov7670, ov5640, ov7740) for the <a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a> board.
<p />
Starting with Linux4SAM 2020.04 we offer support for the Aptina sensor monochrome mt9v022 for all the three boards.
<p />
<h2><a name="The_boot_message"></a> The boot message </h2>
If everything is okay, you can see the log while the system boot-up, it indicates the ov7670 sensor successfully probed.
   <pre>
   ov7670 2-0021: chip found &#64; 0x42 (AT91)
   </pre>
<h2><a name="Device_file_and_sysfs"></a> Device file and sysfs </h2>
After boot up, you can see a character device file named <strong>/dev/video</strong>:
   <pre>
   root&#64;sama5d2-xplained:/# ls -l /dev/video0
   crw-rw---- 1 root video 81, 1 Jul 12 11:56 /dev/video0
   </pre>
The more information is in the sysfs filesystem.
   <pre>
   root&#64;sama5d2-xplained:/# ls sys/class/video4linux/video0
   dev  dev&#95;debug  device  index  name  power  subsystem  uevent
   root&#64;sama5d2-xplained:/# cat /sys/class/video4linux/video0/name
   atmel&#95;isc
   root&#64;sama5d2-xplained:/# cat /sys/class/video4linux/v4l-subdev0/name
   ov7670 2-0021
   </pre>
<h1><a name="User_space_software"></a> User space software </h1>
<h2><a name="Use_the_v4l_utils"></a> Use the <a href="https://linuxtv.org/wiki/index.php/V4l-utils" target="_blank">v4l-utils<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> </h2>
The v4l-utils are a series of packages for handling the video4linux devices. 
<h3><a name="v4L2_compliance"></a> v4L2-compliance </h3>
You can use v4l2-compliance tool to test the v4l2 API compliance of the ISC driver.
<pre>
# v4l2-compliance
v4l2-compliance SHA: 32cf495ff5da24df54936fae3bf0eb91fba77f3a, 32 bits

Compliance test for atmel&#95;isc deviceatmev/video0:el&#95;isc f0008000.isc: &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;  START STATUS  &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
atmel&#95;isc f0008000.isc: Brightness: 0
atmel&#95;isc f0008000.isc: Contrast: 256
atmel&#95;isc f0008000.isc: Gamma: 2


Driver Info:
        Driver name      : atmel&#95;isc
        Card type        : Atmel Image Sensor Controller
        Bus info         : platform:atmel&#95;isc f0008000.isc
        Driver version   : 4.19.16
        Capabilities     : 0x84200001
                Video Capture
                Streaming
                Extended Pix Format
                Device Capabilities
        Device Caps      : 0x04200001
                Video Capture
                Streaming
                Extended Pix Format

Required ioctls:
        test VIDIOC&#95;QUERYCAP: OK

Allow for multiple opens:
        test second /dev/video0 open: OK
        test VIDIOC&#95;QUERYCAP: OK
        test VIDIOC&#95;G/S&#95;PRIORITY: OK
        test for unlimited opens: OK

Debug ioctls:
        test VIDIOC&#95;DBG&#95;G/S&#95;REGISTER: OK (Not Supported)
atmel&#95;isc f0008000.isc: White Balance, Automatic: true
atmel&#95;isc f0008000.isc: &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;  END STATUS  &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
        test VIDIOC&#95;LOG&#95;STATUS: OK

Input ioctls:
        test VIDIOC&#95;G/S&#95;TUNER/ENUM&#95;FREQ&#95;BANDS: OK (Not Supported)
        test VIDIOC&#95;G/S&#95;FREQUENCY: OK (Not Supported)
        test VIDIOC&#95;S&#95;HW&#95;FREQ&#95;SEEK: OK (Not Supported)
        test VIDIOC&#95;ENUMAUDIO: OK (Not Supported)
        test VIDIOC&#95;G/S/ENUMINPUT: OK
        test VIDIOC&#95;G/S&#95;AUDIO: OK (Not Supported)
        Inputs: 1 Audio Inputs: 0 Tuners: 0

Output ioctls:
        test VIDIOC&#95;G/S&#95;MODULATOR: OK (Not Supported)
        test VIDIOC&#95;G/S&#95;FREQUENCY: OK (Not Supported)
        test VIDIOC&#95;ENUMAUDOUT: OK (Not Supported)
        test VIDIOC&#95;G/S/ENUMOUTPUT: OK (Not Supported)
        test VIDIOC&#95;G/S&#95;AUDOUT: OK (Not Supported)
        Outputs: 0 Audio Outputs: 0 Modulators: 0

Input/Output configuration ioctls:
        test VIDIOC&#95;ENUM/G/S/QUERY&#95;STD: OK (Not Supported)
        test VIDIOC&#95;ENUM/G/S/QUERY&#95;DV&#95;TIMINGS: OK (Not Supported)
        test VIDIOC&#95;DV&#95;TIMINGS&#95;CAP: OK (Not Supported)
        test VIDIOC&#95;G/S&#95;EDID: OK (Not Supported)

Control ioctls (Input 0):
        test VIDIOC&#95;QUERY&#95;EXT&#95;CTRL/QUERYMENU: OK
        test VIDIOC&#95;QUERYCTRL: OK
        test VIDIOC&#95;G/S&#95;CTRL: OK
        test VIDIOC&#95;G/S/TRY&#95;EXT&#95;CTRLS: OK
        test VIDIOC&#95;(UN)SUBSCRIBE&#95;EVENT/DQEVENT: OK
        test VIDIOC&#95;G/S&#95;JPEGCOMP: OK (Not Supported)
        Standard Controls: 6 Private Controls: 0

Format ioctls (Input 0):
        test VIDIOC&#95;ENUM&#95;FMT/FRAMESIZES/FRAMEINTERVALS: OK
        test VIDIOC&#95;G/S&#95;PARM: OK
        test VIDIOC&#95;G&#95;FBUF: OK (Not Supported)
        test VIDIOC&#95;G&#95;FMT: OK
        test VIDIOC&#95;TRY&#95;FMT: OK
        test VIDIOC&#95;S&#95;FMT: OK
        test VIDIOC&#95;G&#95;SLICED&#95;VBI&#95;CAP: OK (Not Supported)
        test Cropping: OK (Not Supported)
        test Composing: OK (Not Supported)
        test Scaling: OK (Not Supported)

Codec ioctls (Input 0):
        test VIDIOC&#95;(TRY&#95;)ENCODER&#95;CMD: OK (Not Supported)
        test VIDIOC&#95;G&#95;ENC&#95;INDEX: OK (Not Supported)
        test VIDIOC&#95;(TRY&#95;)DECODER&#95;CMD: OK (Not Supported)

Buffer ioctls (Input 0):
        test VIDIOC&#95;REQBUFS/CREATE&#95;BUFS/QUERYBUF: OK
        test VIDIOC&#95;EXPBUF: OK
        test Requests: OK (Not Supported)

Total for atmel&#95;isc device /dev/video0: 44, Succeeded: 44, Failed: 0, Warnings: 0
</pre>
<h3><a name="v4l2_ctl"></a> v4l2-ctl </h3> <ul>
<li>  Display all information available.
</li></ul> 
<pre>
# v4l2-ctl --all
Driver Info:
        Driver name      : atmel&#95;isc
        Card type        : Atmel Image Sensor Controller
        Bus info         : platform:atmel&#95;isc f0008000.isc
        Driver version   : 4.19.16
        Capabilities     : 0x84200001
                Video Capture
                Streaming
                Extended Pix Format
                Device Capabilities
        Device Caps      : 0x04200001
                Video Capture
                Streaming
                Extended Pix Format
Priority: 2
Video input : 0 (Camera: ok)
Format Video Capture:
        Width/Height      : 640/480
        Pixel Format      : &#39;BA81&#39; (8-bit Bayer BGBG/GRGR)
        Field             : None
        Bytes per Line    : 1280
        Size Image        : 614400
        Colorspace        : sRGB
        Transfer Function : Default (maps to sRGB)
        YCbCr/HSV Encoding: Default (maps to ITU-R 601)
        Quantization      : Default (maps to Full Range)
        Flags             :
Streaming Parameters Video Capture:
        Capabilities     : timeperframe
        Frames per second: 24.000 (24/1)
        Read buffers     : 0

User Controls

                     brightness 0x00980900 (int)    : min&#61;-1024 max&#61;1023 step&#61;1 default&#61;0 value&#61;0 flags&#61;slider
                       contrast 0x00980901 (int)    : min&#61;-2048 max&#61;2047 step&#61;1 default&#61;256 value&#61;256 flags&#61;slider
        white&#95;balance&#95;automatic 0x0098090c (bool)   : default&#61;1 value&#61;1
               do&#95;white&#95;balance 0x0098090d (button) : flags&#61;inactive, write-only, execute-on-write
                          gamma 0x00980910 (int)    : min&#61;0 max&#61;2 step&#61;1 default&#61;2 value&#61;2 flags&#61;slider

</pre> <ul>
<li> Disaplay supported video formats.
</li></ul> 
<pre>
# v4l2-ctl --list-formats
ioctl: VIDIOC&#95;ENUM&#95;FMT
        Type: Video Capture

        &#91;0]: &#39;AR12&#39; (16-bit ARGB 4-4-4-4)
        &#91;1]: &#39;AR15&#39; (16-bit ARGB 1-5-5-5)
        &#91;2]: &#39;RGBP&#39; (16-bit RGB 5-6-5)
        &#91;3]: &#39;AR24&#39; (32-bit BGRA 8-8-8-8)
        &#91;4]: &#39;XR24&#39; (32-bit BGRX 8-8-8-8)
        &#91;5]: &#39;YU12&#39; (Planar YUV 4:2:0)
        &#91;6]: &#39;YUYV&#39; (YUYV 4:2:2)
        &#91;7]: &#39;422P&#39; (Planar YUV 4:2:2)
        &#91;8]: &#39;GREY&#39; (8-bit Greyscale)
        &#91;9]: &#39;BA81&#39; (8-bit Bayer BGBG/GRGR)

</pre> <ul>
<li> Display all controls and their values
</li></ul> 
<pre>
# v4l2-ctl --list-ctrls

User Controls

                     brightness 0x00980900 (int)    : min&#61;-1024 max&#61;1023 step&#61;1 default&#61;0 value&#61;0 flags&#61;slider
                       contrast 0x00980901 (int)    : min&#61;-2048 max&#61;2047 step&#61;1 default&#61;256 value&#61;256 flags&#61;slider
        white&#95;balance&#95;automatic 0x0098090c (bool)   : default&#61;1 value&#61;1
               do&#95;white&#95;balance 0x0098090d (button) : flags&#61;inactive, write-only, execute-on-write
                          gamma 0x00980910 (int)    : min&#61;0 max&#61;2 step&#61;1 default&#61;2 value&#61;2 flags&#61;slider

</pre> <ul>
<li> Get / Set the value of the controls
</li></ul> 
<pre>
root&#64;sama5d2-xplained:/# v4l2-ctl --get-ctrl&#61;contrast
contrast: 256
root&#64;sama5d2-xplained:/# v4l2-ctl --set-ctrl&#61;contrast&#61;200
root&#64;sama5d2-xplained:/# v4l2-ctl --get-ctrl&#61;contrast
contrast: 200
</pre>
<h2><a name="Other_applications"></a> Other applications </h2>
The user space application for ISC is quite similar to ISI, we just include it from <span class="twikiNewLink"><a href="https://www.linux4sam.org/bin/edit/Linux4SAM/UsingISI?topicparent=Linux4SAM.UsingISC;nowysiwyg=1" rel="nofollow" title="UsingISI (this topic does not yet exist; you can create it)">UsingISI</a></span> page.
<p />
<p />
<h3><a name="fswebcam"></a> <a href="http://www.firestorm.cx/fswebcam" target="_blank">fswebcam<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> </h3>
fswebcam is a neat and simple webcam app. It captures images from a V4L1/V4L2 compatible device or file, averages them to reduce noise and draws a caption using the GD Graphics Library which also handles compressing the image to PNG or JPEG. The resulting image is saved to a file or sent to stdio where it can be piped to something like ncftpput or scp.
<p /> <ul>
<li> Add <strong>fswebcam</strong> in Buildroot <ul>
<li> Select <code>"Package Selection for the target -&gt; Graphic libraries and applications -&gt; fswebcam"</code>.
</li></ul> 
</li> <li> Use <strong>fswebcam</strong> to capture a image.   <pre>
#!/bin/sh

VIDEO_DEV=/dev/video0
SKIP_FRAMES=20

# test preview channel
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p RGB565 -r 640x480 rgb565.jpg
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p RGB565 -r 320x240 rgb565_defactor.jpg

# test codec channel
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p YUYV -r 640x480 yuyv.jpg
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p YUYV -r 800x600 yuyv_800x600.jpg

fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p UYVY -r 640x480 uyvy.jpg
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p UYVY -r 800x600 uyvy_800x600.jpg

# test codec channel, without any processing, GREY, or Bayer RGB.
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p BAYER -r 640x480 bayer_bggr8.jpg
fswebcam -S ${SKIP_FRAMES} -d ${VIDEO_DEV} -p SGRBG8 -r 640x480 bayer_grbg8.jpg

   </pre> <ul>
<li> <code>-S</code>: frames that need to skip.
</li> <li> <code>-d /dev/video0</code>: specify the ISI as the input source.
</li> <li> <code>-p</code>: pixel format, can be RGB565, YUYV, UYVY, BAYER, SGRBGB8 and etc.
</li> <li> <code>-r</code>: resolution.
</li></ul> 
</li></ul> 
<p />
<h3><a name="FFmpeg"></a> <a href="http://www.ffmpeg.org/" target="_blank">FFmpeg<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> </h3>
FFmpeg is a complete, cross-platform solution to record, convert and stream audio and video. It supports video4linux2 in Linux.
<p /> <ul>
<li> Add <strong>FFmpeg</strong> in Buildroot (It's already included in the Linux4SAM buildroot demo). <ul>
<li> Select <code>"Package Selection for the target -&gt; Audio and video applications -&gt; ffmpeg"</code>.
</li></ul> 
</li> <li> Use <strong>FFmpeg</strong> to capture a mpeg4 video clip.   <pre>
   ffmpeg -r 25 -s vga -t 20 -pix_fmt yuyv422 -f video4linux2 -i /dev/video0 video.avi
   </pre> <ul>
<li> <code>-r</code>: frame rate
</li> <li> <code>-s</code>: resolution, it can be <code>qcif, cif, qvga, vga, svga, xga, uxga</code>.
</li> <li> <code>-t</code>: time duration in second.
</li> <li> <code>-pix_fmt</code>: pixel format, only support yuyv422.
</li> <li> <code>-f video4linux2</code>: specify the format.  Use <code>ffmpeg -formats</code> will show all supported formats.
</li> <li> <code>-i /dev/video0</code>: specify the ISI as the input source. Run following command to check the source name:         <pre>
# cat /sys/class/video4linux/video0/name
isi-camera
         </pre> 
</li> <li> <code>video.avi</code>: output video file name
</li></ul> 
</li></ul> 
<p />
<strong><em><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/tip.gif" alt="TIP" title="TIP" width="16" height="16" border="0" /> Tips:</em></strong> As no <code>vcodec</code> specified, it use <code>mpeg4</code> as default.
<p />
<strong><em><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/tip.gif" alt="TIP" title="TIP" width="16" height="16" border="0" /> Tips:</em></strong>  Run <code>ffmpeg -pix_fmts</code> can show all the supported pixel formats.
<p /> <ul>
<li> Use <strong>FFmpeg</strong> application to capture images.   <pre>
   ffmpeg -f video4linux2 -r 1 -s vga -t 4 -i /dev/video0 -pix_fmt yuyv422 -f image2 -vcodec png image%d.png
   </pre> <ul>
<li> <code>-r</code>: frame rate
</li> <li> <code>-s</code>: resolution, it can be <code>qcif, cif, qvga, vga, svga, xga, uxga</code>.
</li> <li> <code>-t</code>: time duration in second.
</li> <li> <code>-i /dev/video0</code>: specify the ISI as the input source. Run following command to check the source name:         <pre>
# cat /sys/class/video4linux/video0/name
isi-camera
         </pre> 
</li> <li> <code>-pix_fmt</code>: pixel format, only support yuyv422.
</li> <li> <code>-f image2</code>: image2 sequence format. Use <code>ffmpeg -formats</code> will show all supported formats.
</li> <li> <code>-vcodec png</code>: specify output format is png.  Use <code>ffmpeg -codecs</code> will show all supported codec.
</li> <li> <code>image%d.png</code>: output file name is image1.png, image2.png and etc.
</li></ul> 
</li></ul> 
<p />
<h3><a name="GStreamer"></a> <a href="http://gstreamer.freedesktop.org/" target="_blank">GStreamer<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> </h3>
GStreamer is a library for constructing graphs of media-handling components. The applications it supports range from simple Ogg/Vorbis playback, audio/video streaming to complex audio (mixing) and video (non-linear editing) processing.
<p />
GStreamer has been ported to a wide range of operating systems, processors and compilers.
<p /> <ul>
<li> Add GStreamer in Buildroot (It's already included in the Linux4SAM Buildroot demo). <ul>
<li> Select <code>"Package Selection for the target -&gt; Audio and video applications -&gt; gstreamer"</code> and the plugins that you needed.
</li></ul> 
</li> <li> Use <strong>GStreamer</strong> to preview on LCD.   <pre>
   # gstreamer 0.10
   gst-launch v4l2src device="/dev/video1" ! video/x-raw-yuv,width=640,height=480 ! ffmpegcolorspace ! fbdevsink
   # gstreamer 1.0
   gst-launch-1.0 v4l2src device="/dev/video1" ! video/x-raw,width=640,height=480 ! videoconvert ! fbdevsink
   </pre> <ul>
<li> <code>v4l2src</code>: a plugin to support v4l2 device as a source <ul>
<li> <code>device="/dev/video1"</code>: specify the ISI as the v4l2 input device.  <ul>
<li> You can check the device name by run command: <code>cat /sys/class/video4linux/video1/name</code>
</li></ul> 
</li> <li> <code>video/x-raw-yuv,width=640,height=480</code>: For gstreamer 0.10, specify the v4l2 output video format and size.
</li> <li> <code>video/x-raw,width=640,height=480</code>: For gstreamer 1.0, specify the v4l2 output video format and size.
</li></ul> 
</li> <li> <code>ffmpegcolorspace</code> or <code>videoconvert</code>: a plugin to convert from one color space to another
</li> <li> <code>fbdevsink</code>: a plugin to render to framebuffer device
</li></ul> 
</li></ul> 
<p />
<strong><em><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/tip.gif" alt="TIP" title="TIP" width="16" height="16" border="0" /> Tips:</em></strong> gstreamer 1.0 is different from 0.10, more detail can check: <a href="http://cgit.freedesktop.org/gstreamer/gstreamer/plain/docs/random/porting-to-1.0.txt" target="_blank">http://cgit.freedesktop.org/gstreamer/gstreamer/plain/docs/random/porting-to-1.0.txt<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
<p />
<strong><em><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/tip.gif" alt="TIP" title="TIP" width="16" height="16" border="0" /> Tips:</em></strong> run <code>gst-inspect</code> will show all installed plugins.
<p />
<strong><em><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/tip.gif" alt="TIP" title="TIP" width="16" height="16" border="0" /> Tips:</em></strong> run <code>gst-inspect [plugin name]</code> will show all supported parameters for this plugins.
<p /> <ul>
<li> <img src="../../../pub/Linux4SAM/UsingIsi/isi-gstreamer.png" width='685' height='300' />
</li></ul> 
<p />
<h3><a name="ZXing_barcode_reader"></a> ZXing barcode reader </h3>
ZXing is an open-source, multi-format 1D/2D barcode image processing library implemented in Java, with ports to other languages. The project also includes a barcode reader example.
<p /> <ul>
<li> Add the ZXing barcode reader application in Buildroot. <ul>
<li> Add ZXing libary in Buildroot (The Linux4SAM buildroot demo already include it). <ul>
<li> Select <code>"Package Selection for the target -&gt; Libraries -&gt; Graphics -&gt; zxing"</code>.
</li></ul> 
</li> <li> Apply <a href="https://www.linux4sam.org/pub/Linux4SAM/UsingIsi/0001-zxing-change-the-makefile-to-compile-the-barcode-rea.patch" target="_top">attached patch</a> on top of the buildroot-2012.11.1-at91. <ul>
<li> This patch will change the <strong>zxing</strong> project's Makefile to generate not only zxing library but also the barcode reader example.
</li></ul> 
</li> <li> Run command <code>make zxing</code> to generate the barcode application: <code>zxing_barcode</code>. <ul>
<li> <code>zxing_barcode</code> is located on <code>outpout/target/use/bin/</code>.
</li></ul> 
</li></ul> 
</li></ul> 
<p /> <ul>
<li> Read barcode from the image by using ZXing barcode reader. <ul>
<li> Get an picture which include a barcode. <ul>
<li> Please refer to <strong>FFmpeg</strong> section for the image capture.
</li></ul> 
</li> <li> Run following command to reader the barcode.         <pre>zxing_barcode *.jpg</pre>
</li></ul> 
</li></ul> 
<p />
<p />
<p /> 
	 </div>
  <div class="natMainFooterContents">
	 <div class="natTopicAttachments"> <div class="twikiAttachments">
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table4" rules="all">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<th bgcolor="#687684" class="twikiTableCol0 twikiFirstCol" valign="top"> <a href="UsingISCb65a.html?skin=print.myskin;sortcol=0;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">I</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol1" valign="top"> <a href="UsingISCfdcc.html?skin=print.myskin;sortcol=1;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Attachment</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol2" valign="top"> <a href="UsingISC6b47.html?skin=print.myskin;sortcol=2;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Action</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol3" valign="top"> <a href="UsingISCf99a.html?skin=print.myskin;sortcol=3;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Size</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol4" valign="top"> <a href="UsingISC3f17.html?skin=print.myskin;sortcol=4;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Date</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol5" valign="top"> <a href="UsingISCf1f3.html?skin=print.myskin;sortcol=5;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Who</font></a> </th>
<th bgcolor="#687684" class="twikiTableCol6 twikiLastCol" valign="top"> <a href="UsingISC0b00.html?skin=print.myskin;sortcol=6;table=4;up=0#sorted_table" rel="nofollow" title="Sort by this column"><font color="#ffffff">Comment</font></a> </th>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> <img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/png.gif" width="16" height="16" alt="PNG" title="PNG" border="0" /><span class="twikiHidden">png</span> </td>
<td bgcolor="#ffffff" class="twikiTableCol1 twikiLast" valign="top"> <a href="../../../pub/Linux4SAM/UsingISC/Screenshot_from_2019-04-23_14-01-23.png">Screenshot_from_2019-04-23_14-01-23.png</a> </td>
<td bgcolor="#ffffff" class="twikiTableCol2 twikiLast" valign="top"> <a href="https://www.linux4sam.org/bin/attach/Linux4SAM/UsingISC?filename=Screenshot_from_2019-04-23_14-01-23.png;revInfo=1" title="change, update, previous revisions, move, delete..." rel="nofollow">manage</a> </td>
<td align="right" bgcolor="#ffffff" class="twikiTableCol3 twikiLast" valign="top"> 105.2&nbsp;K </td>
<td bgcolor="#ffffff" class="twikiTableCol4 twikiLast" valign="top"> <span class="twikiNoBreak">2019-04-23 - 11:06</span> </td>
<td bgcolor="#ffffff" class="twikiTableCol5 twikiLast" valign="top"> <a class="twikiLink" href="https://www.linux4sam.org/bin/login/Main/EugenHristev?origurl=/bin/view/Main/EugenHristev">EugenHristev</a> </td>
<td bgcolor="#ffffff" class="twikiTableCol6 twikiLastCol twikiLast" valign="top"> &nbsp; </td>
</tr></table>
</div> </div>
  </div>
  </div>
</div>
</body>

<!-- Mirrored from www.linux4sam.org/bin/view/Linux4SAM/UsingISC?skin=print.myskin by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Jul 2021 19:10:50 GMT -->
</html>
<!-- template: view.print.nat.tmpl -->
<style>
h1,h1 span{color:#000;}
</style>