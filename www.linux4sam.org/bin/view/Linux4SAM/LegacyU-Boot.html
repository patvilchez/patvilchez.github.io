<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<!-- Mirrored from www.linux4sam.org/bin/view/Linux4SAM/LegacyU-Boot by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Jul 2021 19:28:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=iso-8859-1" /><!-- /Added by HTTrack -->
<head>
<link rel="stylesheet" href="https://www.linux4sam.org/pub/TWiki/RedDotPlugin/style.css" type="text/css" media="all" />
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-migrate.js"></script>
<link rel="stylesheet" href="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-all.css" type="text/css" media="all" />
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/JQueryPlugin/jquery-all.js"></script>
<title> LegacyU-Boot &lt; Linux4SAM &lt; TWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="https://www.linux4sam.org/pub/Linux4SAM/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="https://www.linux4sam.org/pub/Linux4SAM/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="alternate" href="https://www.linux4sam.org/bin/edit/Linux4SAM/LegacyU-Boot?t=1625511531" type="application/x-wiki" title="Edit LegacyU-Boot" />
<link rel="edit" href="https://www.linux4sam.org/bin/edit/Linux4SAM/LegacyU-Boot?t=1625511531" title="Edit LegacyU-Boot" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="WebRss" />
<base ></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('https://www.linux4sam.org/pub/TWiki/TWikiTemplates/base.css');
</style>
<style type="text/css" media="all">

#patternTopBar,
#patternClearHeaderCenter,
#patternClearHeaderLeft,
#patternClearHeaderRight,
#patternTopBarContentsOuter,
#patternTopBarContents {
	height:100px; /* top bar height; make room for header columns */
	overflow:hidden;
}


#patternOuter {
	margin-left:14em;
}
#patternLeftBar {
	width:14em;
	margin-left:-14em;
}
</style>
<style type="text/css" media="all">
@import url('https://www.linux4sam.org/pub/TWiki/PatternSkin/layout.css');
@import url('https://www.linux4sam.org/pub/TWiki/PatternSkin/style.css');
@import url('https://www.linux4sam.org/pub/TWiki/PatternSkin/colors.css');
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	.patternBookView .twikiTopRow,
	.patternWebIndicator a img,
	.patternWebIndicator a:hover img {
		background-color:#D0D0D0;
	}
	#patternTopBarContents { background-image:url(https://www.linux4sam.org/pub/TWiki/PatternSkin/TWiki_header.gif); background-repeat:no-repeat;}
	
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/pub/TWiki/PreviewBackground/preview2bg.gif");*/
	}
	
</style><style type="text/css" media="all">


@import url('https://www.linux4sam.org/pub/TWiki/Linux4SAM/mystyle.css');
</style>
<style type="text/css" media="all">
	@import url("https://www.linux4sam.org/pub/TWiki/PatternSkin/print.css");
</style>
<!--[if IE]><style type="text/css" media="screen">
pre {
	overflow-x:auto;
	padding-bottom:expression(this.scrollWidth > this.offsetWidth ? 16 : 0);
}
</style>
<![endif]-->
<!--[if lte IE 6]> 
<style type="text/css">
#patternLeftBar {
	position:relative; /* IE 5.5 needs this or the contents won't show outside the parent container on print. IE 6.0 needs it only during printable copy! */
}
</style><![endif]-->
<script type="text/javascript" src="https://www.linux4sam.org/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script>
<!--GENERATED_HEADERS--><!-- TABLEPLUGIN_table2 --> <style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table2 {width:100%;}
</style></head>
<body class="patternViewPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternWrapper"><div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternClearHeaderCenter">
</div>
<p />
<div id="patternMainContents"><div class="patternTop"><span class="patternHomePath twikiLeft">
<a class="twikiCurrentWebHomeLink twikiLink" href="WebHome.html">Linux4SAM</a><span class='natSep'>&nbsp;&#187; </span><a class="twikiLink" href="LegacyLinux4SAM.html">LegacyLinux4SAM</a><span class='natSep'>&nbsp;&#187; </span><a class="twikiCurrentTopicLink twikiLink" href="LegacyU-Boot.html">LegacyU-Boot</a>
</span><!-- /patternHomePath--><span class="patternToolBar twikiRight"></span><!-- /patternToolBar--><br class="twikiClear" /></div><!--/patternTop--><div class="twikiContentHeader"></div><div class="patternContent"><div class="patternTopic"> <h1><a name="Legacy_U_Boot_Page"></a> Legacy U-Boot Page </h1>
<div class="twikiToc"> <ul>
<li> <a href="#Introduction"> Introduction</a> <ul>
<li> <a href="#U_boot_environment"> U-boot environment</a>
</li></ul> 
</li> <li> <a href="#Load_u_boot_on_AT91_boards"> Load u-boot on AT91 boards</a>
</li> <li> <a href="#Use_u_boot"> Use u-boot</a> <ul>
<li> <a href="#U_boot_Main_Commands"> U-boot Main Commands</a>
</li> <li> <a href="#U_boot_script_capability"> U-boot script capability</a>
</li> <li> <a href="#Boot_pre_defined_variables_and_c"> Boot pre-defined variables and command:</a>
</li></ul> 
</li> <li> <a href="#Load_Linux_with_u_boot_on_AT91_b"> Load Linux with u-boot on AT91 boards</a> <ul>
<li> <a href="#Preparing_linux_image"> Preparing linux image</a>
</li> <li> <a href="#Loading_through_network"> Loading through network</a>
</li> <li> <a href="#Loading_from_flash"> Loading from flash</a>
</li> <li> <a href="#Choosing_where_the_u_boot_enviro"> Choosing where the u-boot environment resides</a>
</li> <li> <a href="#Cross_compiling_u_boot"> Cross-compiling u-boot</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2><a name="Introduction"></a> Introduction </h2>
<p />
Das U-Boot - the Universal Boot Loader <a href="http://www.denx.de/wiki/U-Boot" target="_blank">wiki website<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> is the main entry point for this bootloader / debugging tool available on several processors. It is of course available for AT91 ARM processors.
<p />
U-boot documentation is very rich ; in addition to the official u-boot website, several others are dealing with u-boot getting started or configuration. An article from <a href="http://www.linuxdevices.com/" target="_blank">http://www.linuxdevices.com<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> also gives a <a href="http://linuxdevices.com/articles/AT5085702347.html" target="_blank">good introduction to u-boot<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>. Note however that a detailed documentation is simply available in the source code package as the <a href="http://www.denx.de/cgi-bin/gitweb.cgi?p=u-boot.git;a=blob_plain;f=README" target="_blank">README<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> file. Thematic documentation is also available in the <a href="http://www.denx.de/cgi-bin/gitweb.cgi?p=u-boot.git;a=tree;f=doc" target="_blank"> <code>doc/</code> <img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> directory.
<p />
U-boot takes place in the Linux demo as a second stage bootloader. It is responsible of configuring main interfaces and launching a Linux system. Note however that it is possible to avoid this step and to directly boot Linux from <a class="twikiLink" href="AT91Bootstrap.html">AT91Bootstrap</a>, in a production phase for instance.
<p />
<h3><a name="U_boot_environment"></a> U-boot environment </h3>
<p />
The <a href="http://www.denx.de/wiki/view/DULG/UBootEnvVariables" target="_blank">u-boot environment<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> is a little read/write persistent space that stores variables needed by the bootloader to configure itself properly and to adapt to its environment (network configuration, boot arguments, storage location, etc.). It is located in the same media that it has booted from. Check <a class="twikiAnchorLink" href="AT91Bootstrap.html#Boot_capabilities_matrix">Boot capabilities matrix</a> to know where the u-boot environment is located for the pre-built binary.
<p />
<p />
<h2><a name="Load_u_boot_on_AT91_boards"></a> Load u-boot on AT91 boards </h2>
<p />
This section describes How to load u-boot into the boot media with SAM-BA.
<p /> <ul>
<li> Connect the USB Device Interface to your host machine using the USB Device Cable
</li> <li> Make sure that the chip can execute the bootROM monitor SAM-BA-boot :
</li></ul> 
<p /> <ul>
<li> Start SAM-BA GUI Application
</li> <li> Select the the board in the drop-down menu and choose the USB Connection
</li></ul> 
<img alt="SAM-BA_selectboard.jpg" src="../../../pub/Linux4SAM/LegacyU-Boot/SAM-BA_selectboard.html" /> <ul>
<li> Eventually plug back a jumper to access the media on which u-boot must be loaded to
</li> <li> In the main SAM-BA window :
</li></ul> 
<img alt="SAM-BA_mainwin-uboot.png" src="../../../pub/Linux4SAM/LegacyU-Boot/SAM-BA_mainwin-uboot.html" /> <ol>
<li> Choose the proper <em>media tab</em> (DataFlash, NandFlash, etc.) in the SAM-BA GUI interface
</li> <li> Initialize the media choosing the <em>Enable</em> action in the <em>Scripts</em> rolling menu and press <em>Execute</em> 
</li> <li> Press on <em>Send File Name</em> Browse button
</li> <li> Choose u-boot.bin binary file and press <em>Open</em> 
</li> <li> Enter the proper address on media in the <em>Address</em> text field. You can find a media map for each product in <a class="twikiAnchorLink" href="GettingStarted.html#Linux4SAM_DataFlash_demo_Memory">GettingStarted#Linux4SAM_DataFlash_demo_Memory</a> and <a class="twikiAnchorLink" href="GettingStarted.html#Linux4SAM_NandFlash_demo_Memory">GettingStarted#Linux4SAM_NandFlash_demo_Memory</a>
</li> <li> Press <em>Send File</em> button
</li> <li> On AT91SAM9260-EK or AT91SAM9XE-EK, If you have erased the booting media, do not forget to replace <a class="twikiLink" href="AT91Bootstrap.html">AT91Bootstrap</a> in it
</li> <li> Close SAM-BA, remove the USB cable
</li></ol> 
<p />
Ok, now you must have a running u-boot flashed on your board. To check, you can have a look at the DBGU serial interface once you have reset the board.
<p />
<p />
<h2><a name="Use_u_boot"></a> Use u-boot </h2>
<p />
Using a terminal software on your host system, you can connect to u-boot through the DBGU serial interface.<br />
<p />
Serial communication parameters <code>115200 8-N-1</code> :
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table1" rules="all">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Baud rate </td>
<td bgcolor="#ffffff" class="twikiTableCol1 twikiLastCol" valign="top"> 115200 </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Data </td>
<td bgcolor="#edf4f9" class="twikiTableCol1 twikiLastCol" valign="top"> 8 bits </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> Parity </td>
<td bgcolor="#ffffff" class="twikiTableCol1 twikiLastCol" valign="top"> None </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> Stop </td>
<td bgcolor="#edf4f9" class="twikiTableCol1 twikiLastCol" valign="top"> 1 bit </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> Flow control </td>
<td bgcolor="#ffffff" class="twikiTableCol1 twikiLastCol twikiLast" valign="top"> None </td>
</tr></table>
<p />
<h3><a name="U_boot_Main_Commands"></a> U-boot Main Commands </h3>
<p />
<strong>setenv</strong> this command is used to set variables<br />
<strong>saveenv</strong> this command saves variables previously set in the environment permanent storage space<br />
<strong>printenv</strong> this command print the current variables
<p />
The <code>help</code> command show a brief summary of the built-in commands of u-boot. Here is a selection of useful commands :
<pre>
U-Boot&#62; help
?       - alias for &#39;help&#39;
boot    - boot default, i.e., run &#39;bootcmd&#39;
bootm   - boot application image from memory
cp      - memory copy
erase   - erase FLASH memory
flinfo  - print FLASH memory information
go      - start application at address &#39;addr&#39;
help    - print online help
md      - memory display
mm      - memory modify (auto-incrementing)
nand    - NAND sub-system
printenv- print environment variables
protect - enable or disable FLASH write protection
run     - run commands in an environment variable
saveenv - save environment variables to persistent storage
setenv  - set environment variables
tftpboot- boot image via network using TFTP protocol
version - print monitor version
U-Boot&#62;
</pre>
<p />
Refer to the u-boot manual page for u-boot <a href="http://www.denx.de/wiki/view/DULG/UBootCommandLineInterface" target="_blank">command line interface<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>.
<h3><a name="U_boot_script_capability"></a> U-boot script capability </h3>
<p />
You can create script or complex variables, which prevents you to type commands. Here is a summary of several variables built to make a network loading of linux easier :
<pre>
setenv boot&#95;addr 0x21400000
setenv linux &#39;tftp $(boot&#95;addr) linux-2.6.x.img&#39;
setenv ramdisk&#95;addr 0x21100000
setenv ramdisk &#39;tftp $(ramdisk&#95;addr) sam9-ramdisk.gz&#39;
setenv go &#39;run linux; run ramdisk; bootm $(boot&#95;addr)&#39;
saveenv
</pre>
<p />
The <code>setenv linux 'tftp $(boot_addr) linux-2.6.x.img'</code> line is equivalent of typing <code>tftp 0x21400000 linux-2.6.x.img</code> but combined with others and stored in flash, it allows you to save time, and automate. For executing a Linux kernel bootup, using this snippet, simply type <code>run go</code> 
<p />
<h3><a name="Boot_pre_defined_variables_and_c"></a> Boot pre-defined variables and command: </h3>
<p />
<strong><a href="http://www.denx.de/wiki/view/DULG/UBootCmdGroupEnvironment#Section_5.9.6.5." target="_blank">bootcmd<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a></strong> when set, this variable content is executed automatically after the boot delay. It enables the u-boot autoboot mode<br />
<strong><a href="http://www.denx.de/wiki/view/DULG/LinuxKernelArgs" target="_blank">bootargs<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a></strong> this variable it used as an exchange area to pass information to the main application started by u-boot (Linux kernel for instance)<br />
<strong><a href="http://www.denx.de/wiki/view/DULG/UBootCmdGroupExec#Section_5.9.4.2." target="_blank">bootm<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a></strong> this command executes an application generated by the <em>mkimage</em> tool<br>
<p />
<h2><a name="Load_Linux_with_u_boot_on_AT91_b"></a> Load Linux with u-boot on AT91 boards </h2>
<p />
This section describes the loading of a Linux kernel and it root file system. Keep in mind <a class="twikiAnchorLink" href="U-Boot.html#U_boot_Main_Commands">useful u-boot commands</a> to setup your u-boot behavior.
<p />
<h3><a name="Preparing_linux_image"></a> Preparing linux image </h3>
<p />
U-Boot does not support normal linux kernel images like zImage or Image (arch/arm/boot/), you have to create an uImage file with the <em>mkimage</em> tool which encapsulates kernel image with header information, CRC32 checksum, etc. 
<p />
<em>mkimage</em> comes in source code with U-Boot distribution and it is built during U-Boot compilation (u-boot-source-dir/tools/mkimage), we provide also <a class="twikiAnchorLink" href="SoftwareTools.html#mkimage_U_Boot">pre-built static version</a>. 
<p />
See U-Boot <a href="http://www.denx.de/cgi-bin/gitweb.cgi?p=u-boot.git;a=blob_plain;f=README" target="_blank">README<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> file for more information.
<p />
Command to generate an uncompressed uImage file {{<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/warning.gif" width="16" height="16" alt="Warning, important" title="Warning, important" border="0" /> for <strong>at91sam9g45 family</strong>: use proper location for RAM: 0x70000000 instead of 0x20000000}} :
<pre>
mkimage -A arm -O linux -C none -T kernel -a 20008000 -e 20008000 -n linux-2.6 -d arch/arm/boot/Image uImage
</pre>
<p />
Commands to generate a compressed uImage file {{<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/warning.gif" width="16" height="16" alt="Warning, important" title="Warning, important" border="0" /> for <strong>at91sam9g45 family</strong>: use proper location for RAM: 0x70000000 instead of 0x20000000}} :
<pre>
mkimage -A arm -O linux -C none -T kernel -a 20008000 -e 20008000 -n linux-2.6 -d arch/arm/boot/zImage uImage
</pre>
<p />
<h3><a name="Loading_through_network"></a> Loading through network </h3>
<p />
On a development system, it is useful to get the kernel and root file system through the network. U-boot provides support for loading binaries from a remote host on the network using the <a href="ftp://ftp.rfc-editor.org/in-notes/rfc1350.txt" target="_blank">TFTP protocol<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>.
<p />
To manage to use TFTP with u-boot, you will have to configure a TFTP server on your host machine. Check your distribution manual or Internet resources to configure a Linux or Windows TFTP server on your host:
<p /> <ul>
<li> <a href="http://www.denx.de/wiki/view/DULG/SystemSetup#Section_4.6." target="_blank">u-boot documentation on a Linux host<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li> <li> <a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch16_:_Telnet%2C_TFTP%2C_and_xinetd#TFTP" target="_blank">another TFTP configuration reference<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
</li></ul> 
<p />
On the u-boot side, you will have to setup the networking parameters:
<p /> <ol>
<li> setup an Ethernet address (MAC address)<br />Check <a href="http://www.denx.de/wiki/DULG/EthernetDoesNotWork" target="_blank">this u-boot network BuildRootFAQ entry<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> to choose a proper MAC address.<br /> <code>setenv ethaddr 3e:36:65:ba:6f:be</code> 
</li> <li> setup IP parameters <ul>
<li> the board ip address<br /> <code>setenv ipaddr 10.159.245.180</code> 
</li> <li> the server ip address where the TFTP server is running<br /> <code>setenv serverip 10.159.245.186</code> 
</li></ul> 
</li> <li> saving Environment to flash<br /> <code>saveenv</code> 
</li> <li> if Ethernet Phy has not been detected during former bootup, reset the board to reload u-boot : the Ethernet address and Phy initialization shall be ok, now
</li> <li> download the Linux <em>uImage</em> and the root file system to a ram location using the u-boot <code>tftp</code> command (Cf. <a class="twikiAnchorLink" href="U-Boot.html#U_boot_script_capability">U-Boot script capability chapter</a>).
</li> <li> launch Linux issuing a <code>bootm</code> or <code>boot</code> command.
</li></ol> 
<p />
<!--
<h3><a name="Loading_from_flash"></a> Loading from flash </h3>
<p />
<a href="http://www.at91.com/phpbb/viewtopic.php?t=3641" target="_blank">http://www.at91.com/phpbb/viewtopic.php?t=3641<img alt="" border="0" height="12" src="/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/todo.gif" width="37" height="16" alt="TODO" border="0" />
<p />
<pre>
cp.b 0x22200000 c0040000 2b2c2c
Copy to DataFlash... done
</pre>
&nbsp;
<pre>
cp.b c0040000 0x22200000 2b2c2c
</pre>
<p />
-->
<p />
<h3><a name="Choosing_where_the_u_boot_enviro"></a> Choosing where the u-boot environment resides </h3>
<p />
Above, we talked about the <a class="twikiAnchorLink" href="U-Boot.html#U_boot_environment">location of the u-boot environment</a>. Here is a way to modify it to your needs :
<p />
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> With <strong>newer revisions of u-boot</strong> (u-boot-1.1.5_atmel_1.7.diff patch, u-boot-1.3.4 and later) you can choose location of environment variables at configuration step.
<p />
To put environment variables in dataflash (default):
<pre>
   make at91sam9xxxek&#95;dataflash&#95;config
or
   make at91sam9xxxek&#95;dataflash&#95;cs0&#95;config
</pre>
To put environment variables in nandflash:
<pre>
   make at91sam9xxxek&#95;nandflash&#95;config
</pre>
<p />
Please go to the top-level <code>Makefile</code> or read the <code>README.at91</code> file in the <code>doc</code> directory of u-boot to find the exact target when invoking <em>make</em>.
<p />
<strong>With older revisions</strong>, the environment configuration resides in a header file ; you just have to <code>define</code> or <code>undef</code> pre-compilation variables: 
<p />
<table border="1" cellpadding="0" cellspacing="0" class="twikiTable" id="table2" rules="all" width="100%">
<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<th bgcolor="#687684" class="twikiTableCol0 twikiFirstCol" valign="top"> <font color="#ffffff">Product</font> </th>
<th bgcolor="#687684" class="twikiTableCol1" valign="top"> <font color="#ffffff">Config file</font> </th>
<th bgcolor="#687684" class="twikiTableCol2 twikiLastCol" valign="top"> <font color="#ffffff">Piece of code involved</font> </th>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> AT91rm9200ek </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> <code>include/configs/at91rm9200ek.h</code> </td>
<td bgcolor="#ffffff" class="twikiTableCol2 twikiLastCol" valign="top"> <pre>#undef  CFG&#95;ENV&#95;IS&#95;IN&#95;DATAFLASH

#ifdef CFG&#95;ENV&#95;IS&#95;IN&#95;DATAFLASH
&#91;..]
#else
#define CFG&#95;ENV&#95;IS&#95;IN&#95;FLASH  1
&#91;..]
#endif</pre> </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol" valign="top"> AT91sam9260ek </td>
<td bgcolor="#edf4f9" class="twikiTableCol1" valign="top"> <code>include/configs/at91sam9260ek.h</code> </td>
<td bgcolor="#edf4f9" class="twikiTableCol2 twikiLastCol" valign="top"> <pre>#define CFG&#95;ENV&#95;IS&#95;IN&#95;DATAFLASH  1
#undef CFG&#95;ENV&#95;IS&#95;IN&#95;NAND</pre> </td>
</tr>
<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
<td bgcolor="#ffffff" class="twikiTableCol0 twikiFirstCol" valign="top"> AT91sam9261ek </td>
<td bgcolor="#ffffff" class="twikiTableCol1" valign="top"> <code>include/configs/at91sam9261ek.h</code> </td>
<td bgcolor="#ffffff" class="twikiTableCol2 twikiLastCol" valign="top"> <pre>#define CFG&#95;ENV&#95;IS&#95;IN&#95;DATAFLASH  1</pre> </td>
</tr>
<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
<td bgcolor="#edf4f9" class="twikiTableCol0 twikiFirstCol twikiLast" valign="top"> AT91sam9263ek </td>
<td bgcolor="#edf4f9" class="twikiTableCol1 twikiLast" valign="top"> <code>include/configs/at91sam9260ek.h</code> </td>
<td bgcolor="#edf4f9" class="twikiTableCol2 twikiLastCol twikiLast" valign="top"> <pre>#define CFG&#95;ENV&#95;IS&#95;IN&#95;DATAFLASH  1</pre> </td>
</tr></table>
<p />
<img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/hand.gif" width="16" height="16" alt="Pointing hand" title="Pointing hand" border="0" /> Note that <code>CFG_ENV_IS_IN_FLASH</code> means environment in <strong>NOR FLASH</strong>. This option is not supported "out of the box" for all products but certainly can be implemented.
<p />
Additional information about those variables are availlable in the <a href="http://www.denx.de/cgi-bin/gitweb.cgi?p=u-boot.git;a=blob_plain;f=README" target="_blank">u-boot README<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> (search "- CFG_ENV_IS_IN_FLASH").
<p />
<h3><a name="Cross_compiling_u_boot"></a> Cross-compiling u-boot </h3>
<p />
Once the AT91 u-boot sources available, cross-compile u-boot is made in two steps : configuration and compiling. Check the <a href="http://www.denx.de/wiki/view/DULG/UBootConfiguration" target="_blank">Configuration chapter<img alt="" border="0" height="12" src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> in u-boot reference manual.
<p />
Note that both arm-elf- and arm-linux- ARM GCC cross-compiler types are suitable for u-boot building. 
<p />
Here are the building steps for the AT91sam9263ek board:
<pre>
make distclean
make at91sam9263ek&#95;config
make CROSS&#95;COMPILE&#61;&#60;path&#95;to&#95;cross-compiler/cross-compiler-prefix-&#62;
</pre>
<p />
<em>path_to_cross-compiler</em> is only needed if it is not in your <code>PATH</code>.<br />
Usually <em>cross-compiler-prefix-</em> looks like <em>arm-linux-</em> or <em>arm-elf-</em>
<p />
The result of these operations is a fresh u-boot binary called <code>u-boot.bin</code> corresponding to the binary ELF file <code>u-boot</code>. <ul>
<li> <code>u-boot.bin</code> is the file you should store on the board
</li> <li> <code>u-boot</code> is the ELF format binary file you may use to debug u-boot through a JTag link for instance.
</li></ul>  </div><!-- /patternTopic-->
<div class="twikiContentFooter"></div></div><!-- /patternContent-->
<div class="patternInfo twikiGrayText"><div class="patternRevInfo">r3 - 17 Apr 2018 - 12:16:49 - <a class="twikiLink" href="https://www.linux4sam.org/bin/login/Main/TWikiAdminUser?origurl=/bin/view/Main/TWikiAdminUser">TWikiAdminUser</a></div><!-- /patternRevInfo--></div><!-- /patternInfo-->
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
<div id="patternLeftBar">
<div id="patternClearHeaderLeft"></div>
<div id="patternLeftBarContents">
<div class="patternWebIndicator"> <ul>
<li> <a class="twikiCurrentWebHomeLink twikiLink" href="WebHome.html"><img src="https://www.linux4sam.org/pub/TWiki/TWikiDocGraphics/web-bg-small.gif" width="13" height="13" alt="Web background" title="Web background" border="0" /> Linux4SAM</a>
</li></ul> 
</div>
<br>
<h2><a name="Linux4SAM"></a> <a class="twikiCurrentWebHomeLink twikiLink" href="WebHome.html"> Linux4SAM</a> </h2>
<ul>
  <li><a class="twikiLink" href="SoftwareTools.html">Software tools</a></li>
  <li><a class="twikiLink" href="AT91Bootstrap.html">AT91Bootstrap</a></li>
  <li><a class="twikiLink" href="U-Boot.html">U-Boot</a>
  <li><a class="twikiLink" href="LinuxKernel.html">Linux Kernel</a></li>
  <li><a class="twikiLink" href="DT-Overlay.html">DT-Overlay</a></li>
</ul>
<p />
<u><a class="twikiCurrentWebHomeLink twikiAnchorLink" href="WebHome.html#Open_source_embedded_distributio">Open source solutions</a></u>
<ul>
    <li><a class="twikiLink" href="YoctoProject.html">Yocto Project</a></li>
    <!--<li><a class="twikiLink" href="/bin/view/Linux4SAM/OpenEmbeddedAngstrom">OpenEmbedded / Angstrom</a></li>-->
    <li><a class="twikiLink" href="BuildRoot.html">Buildroot</a></li>
    <li><a class="twikiLink" href="OpenWrt.html">OpenWrt</a></li>
</ul>
<p />
<u><a class="twikiCurrentWebHomeLink twikiAnchorLink" href="WebHome.html#Applications">Applications</a></u>
<ul>
    <li><a class="twikiAnchorLink" href="Applications.html#Graphics_Toolkit">Graphics Toolkit</a></li>
    <li><a class="twikiAnchorLink" href="Applications.html#WiFi_and_Bluetooth">WiFi and Bluetooth</a></li>
</ul>
<p />
<h2><a name="Boards"></a> Boards </h2>
<ul>
    <li><a class="twikiLink" href="Sama5d2IcpMainPage.html">SAMA5D2-ICP</a></li>
    <li><a class="twikiLink" href="Sama5d27WLSom1EKMainPage.html">SAMA5D27 WLSOM1 EK</a></li>
    <li><a class="twikiLink" href="Sam9x60EKMainPage.html">SAM9X60-EK</a></li>
    <li><a class="twikiLink" href="Sama5d27Som1EKMainPage.html">SAMA5D27 SOM1 EK</a></li>
    <li><a class="twikiLink" href="Sama5d2PtcEKMainPage.html">SAMA5D2 PTC EK</a></li>
    <li><a class="twikiLink" href="Sama5d2XplainedMainPage.html">SAMA5D2 Xplained</a></li>
    <li><a class="twikiLink" href="Sama5d3XplainedMainPage.html">SAMA5D3 Xplained</a></li>
    <li><a class="twikiLink" href="Sama5d4XplainedMainPage.html">SAMA5D4 Xplained</a></li>
    <li><a class="twikiLink" href="GettingStarted.html">Older boards</a></li>
</ul>
<p />
<p />
<h2><a name="FAQ"></a> <a class="twikiLink" href="WebFaq.html">FAQ</a> </h2>
<div class="twikiToc"> <ul>
<li> <a href="WebFaq.html#FAQ_updates_by_Boards"> FAQ updates by Boards</a>
</li> <li> <a href="WebFaq.html#FAQ_updates_by_Components"> FAQ updates by Components</a>
</li></ul> 
</div>
<p />
<!--
<u>FAQ</u>
<ul>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/U-BootFAQ">U-Boot FAQ</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/BuildRootFAQ">BuildRoot FAQ</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/AudioFAQ">Audio FAQ</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/FAQ_9x5">AT91SAM9x5 FAQ</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/FAQ_9n12">AT91SAM9N12 FAQ</a></li>
</ul>
<p />
<u><a class="twikiLink" href="/bin/view/Linux4SAM/TipsNTricks">Tips &amp; Tricks</a></u>
<ul>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/AudioRecordOnAt91sam9g20ek">9G20EK Audio Recording</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/SAM9M10Gstreamer">9M10 vdec with Gstreamer</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/IioAdcDriver">IIO ADC driver</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/RealTime">Real Time on A91SAM SoC</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/SDCardBootNotice">SD card boot for AT91SAM SoC</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/PmeccConfigure">NAND ECC configuration (PMECC)</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/AT91BootstrapDebugEclipse">AT91Bootstrap Debugging with Eclipse for Linux</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/UsingIsi">Using ISI (Image Sensor Interface)</a></li>
    <li><a class="twikiLink" href="/bin/view/Linux4SAM/UsingMaxTouch">Using maXTouch (capacitive touchscreen)</a></li>
</ul>
<p />
<br><br>
<h2><a name="Demos"></a> <a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demo_archives">Demos</a> </h2>
<p />
<u>For following products:</u>
<br><br>
<ul>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demoa5d4xplained">SAMA5D4 Xplained</a></li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demoa5d4ek">SAMA5D4-EK</a> <br />  &nbsp;</li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demoa5d3x">SAMA5D3x-EK</a></li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demoa5d3x_yocto">SAMA5D3x-EK <br /> Home Automation Demo <br />  with Yocto</a></li>
  <li><a href="http://www.timesys.com/embedded-linux/resources/dev-center/sama5d3" target="_blank">SAMA5D3x-EK <br /> Home Automation Demo <br />  with LinuxLink<img alt="" border="0" height="12" src="/pub/TWiki/TWikiDocGraphics/external-link.gif" width="13" /></a> <br />  &nbsp;</li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted_9n12#Demo_archives">AT91SAM9N12-EK</a></li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted_9x5#Demo_archives">AT91SAM9x5-EK</a></li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demo9m10g45ek">AT91SAM9M10G45-EK</a></li>
  <li><a class="twikiAnchorLink" href="/bin/view/Linux4SAM/GettingStarted#Demo9g20">AT91SAM9G20-EK</a></li>
</ul>
-->
<p />
<p />
<h2><a name="Useful_links"></a> <a class="twikiLink" href="LinksToCommunities.html">Useful links</a> </h2>
<ul>
  <li><a href="https://www.microchip.com/forums/f540.aspx" target="_blank">Microchip Microprocessors forums</a></li>
  <li><a href="http://www.at91.com/" target="_blank">AT91 Community (archive)</a></li>
  <li><a href="http://www.microchip.com/" target="_blank">Microchip</a></li>
  <li><a href="https://github.com/linux4sam" target="_blank">Linux4SAM on GitHub</a></li>
  <!--<li><a class="twikiLink" href="/bin/view/Linux4SAM/LinuxNewsletter">Atmel | Linux newsletter</a></li>-->
</ul>
<br><br>
<h2><a name="NAVIGATION"></a> NAVIGATION </h2>
<p />
<div id="navButtonl">
<a class="twikiCurrentWebHomeLink twikiLink" href="WebHome.html"> Linux4SAM</a>
</div> <ul>
<li> <a class="twikiLink" href="WebTopicList.html"> Index</a>
</li> <li> <a class="twikiLink" href="WebChanges.html"> Changes</a>
</li> <li> <a class="twikiLink" href="WebNotify.html"> Notifications</a>
</li> <li> <a class="twikiLink" href="WebStatistics.html"> Statistics</a>
</li></ul> 
<p />
</div>
<!-- /patternLeftBarContents--></div>
<!-- /patternLeftBar-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--></div><!-- /patternWrapper-->
<div id="patternTopBar">
<div id="patternTopBarContents">
<table border="0" cellpadding="0" cellspacing="0" style="width:100%; margin-top:12px;">
<tr><td valign="middle"><span id="twikiLogo" class="twikiImage"><a href="../Linux4SAM.html"><img src="../../../pub/Main/TWikiPreferences/tux2_atmel_header.png" border="0" alt="Linux4SAM" style="border:none;" /></a></span></td>
<td align="right" valign="top" class="patternMetaMenu">
 <ul>
<li> <form name="jumpForm" action="https://www.linux4sam.org/bin/view/Linux4SAM/LegacyU-Boot"><input id="jumpFormField" type="text" class="twikiInputField" name="topic" value="" size="18" /><noscript>&nbsp;<input type="submit" class="twikiButton" size="5" name="submit" value="Jump" />&nbsp;</noscript>   </form>
</li> <li> <form name="quickSearchForm" action="https://www.linux4sam.org/bin/view/Linux4SAM/WebSearch"><input type="text" class="twikiInputField" id="quickSearchBox" name="search" value="" size="18" /><input type="hidden" name="scope" value="all" /><input type="hidden" name="web" value="Linux4SAM" /><noscript>&nbsp;<input type="submit" size="5" class="twikiButton" name="submit" value="Search" />&nbsp;</noscript>   </form>
</li> <li> 
</li></ul> 
</td></tr></table>
<div class="page-title"> Linux &amp; Open Source for AT91 Microchip Microprocessors</div>
<div class="page-print">
<p>
<p />
<a href="LegacyU-Boot3fe3.html?skin=print.myskin">Print</a></p>
<p />
</div>
</div></div>
<!-- /patternTopBar-->
<div id="patternBottomBar">
<div id="patternBottomBarContents">
<div id="patternWebBottomBar">
<p>Copyright &copy; by the contributing authors. All material on this collaboration platform is the property of the contributing authors. </p>
<p>Linux&reg; is the registered trademark of Linus Torvalds in the U.S. and other countries. </p>
<p>Microchip&reg; and others, are registered trademarks or trademarks of Microchip Technology Inc. and its subsidiaries. <a href="http://twiki.org/" target="_blank" class="natExternalLink"><img width="80" height="15" border="0" title="This site is powered by the TWiki collaboration platform" alt="This site is powered by the TWiki collaboration platform" src="https://www.linux4sam.org/linux4sam/T-logo-80x15.gif" class="img-twiki"></a></p>
<p>Arm&reg; and others are registered trademarks or trademarks of Arm Limited (or its affiliates).  Other terms and product names may be trademarks of others.</p>
<p>Ideas, requests, contributions ? Connect to <a href="LinksToCommunities.html" class="twikiLink">LinksToCommunities</a> page.</p>
<p>Syndicate this site<a href="WebRss" class="linux4sam-rss">RSS</a>
<a href="WebAtom" class="linux4sam-rss">ATOM</a></p>
</div>
<!--/patternWebBottomBar--></div>
<!-- /patternBottomBarContents--></div>
<!-- /patternBottomBar-->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10893750-1");
pageTracker._initData();
pageTracker._trackPageview();
} catch(err) {}
</script>
<script type="text/javascript">
  _bizo_data_partner_id = "8288";
</script>
<script type="text/javascript">
	(function() {
		  var s = document.getElementsByTagName("script")[0];
		  var b = document.createElement("script");
		  b.type = "text/javascript";
		  b.async = true;
		  b.src = (window.location.protocol === "https:" ? "https://sjs" : "http://js") + ".bizographics.com/insight.min.js";
		  s.parentNode.insertBefore(b, s);
	 })();
</script>
<noscript>
  <img height="1" width="1" alt="" style="display:none;" src="http://www.bizographics.com/collect/?pid=8288&amp;fmt=gif" />
</noscript>
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body>
<!-- Mirrored from www.linux4sam.org/bin/view/Linux4SAM/LegacyU-Boot by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Jul 2021 19:28:52 GMT -->
</html>